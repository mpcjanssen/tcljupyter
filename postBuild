export REPO=`pwd`
echo `pwd`
echo $CONDA_DIR
export PREFIX=${CONDA_DIR}/envs/notebook

cd ${PREFIX}
mkdir -p src
cd src
export TCLLIBPATH=$PREFIX

wget https://github.com/mpcjanssen/rl_json/archive/0.11.0.tar.gz -O rl_json.tar.gz
tar xvf rl_json.tar.gz
cd rl_json-0.11.0
./configure --prefix=$PREFIX
make && make install
cd ..


wget https://github.com/mpcjanssen/tcllib/archive/tcllib-1-20.tar.gz -O tcllib.tar.gz
tar xvf tcllib.tar.gz
cd tcllib-tcllib-1-20
./configure --prefix=$PREFIX
make && make install
cd ..

wget https://github.com/mpcjanssen/critcl/archive/3.1.18.1.tar.gz -O criticl.tar.gz
tar xvf criticl.tar.gz
cd critcl-3.1.18.1/
tclsh build.tcl install
cd ..

wget https://github.com/mpcjanssen/tclzmq/archive/binder.tar.gz -O tclzmq.tar.gz
tar xvf tclzmq.tar.gz
cd tclzmq-binder
tclsh build.tcl install $PREFIX -zmq ${PREFIX}
cd ..
export KERNELPATH=$PREFIX/share/jupyter/kernels/tcljupyter
mkdir -p $KERNELPATH

cp $REPO/kernel.json.binder $KERNELPATH/kernel.json
cp $REPO/init.tcl $KERNELPATH/
cp -R $REPO/modules $KERNELPATH/

tclsh $KERNELPATH/init.tcl
echo `ls -R  $PREFIX/share/jupyter/kernels/`
